# Домашнее задание к занятию "Как работает сеть в K8S"

### Цель задания

Настроить сетевую политику доступа к подам.

### Чеклист готовности к домашнему заданию

1. Кластер k8s с установленным сетевым плагином calico

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Calico](https://www.tigera.io/project-calico/)
2. [Network Policy](https://kubernetes.io/docs/concepts/services-networking/network-policies/)
3. [About Network Policy](https://docs.projectcalico.org/about/about-network-policy)

-----

### Задание 1. Создать сетевую политику (или несколько политик) для обеспечения доступа

1. Создать deployment'ы приложений frontend, backend и cache и соответсвующие сервисы.  
Создал [frontend](https://github.com/AlekseyDrobnyi/netology_devops/blob/main/14.3/yml/frontend.yaml), [backend](https://github.com/AlekseyDrobnyi/netology_devops/blob/main/14.3/yml/backend.yaml) и [cache](https://github.com/AlekseyDrobnyi/netology_devops/blob/main/14.3/yml/cache.yaml)

2. В качестве образа использовать network-multitool. 
3. Разместить поды в namespace app.   
Создал [namespace app](https://github.com/AlekseyDrobnyi/netology_devops/blob/main/14.3/yml/namespace.yaml)  
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl apply -f namespace.yaml 
namespace/app created
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get ns
NAME              STATUS   AGE
app               Active   4s
default           Active   28m
kube-node-lease   Active   28m
kube-public       Active   28m
kube-system       Active   28m
```
Создаю `deployment'ы` и `servic-ы`  
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl apply -f frontend.yaml 
deployment.apps/frontend created
service/frontend created
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl apply -f backend.yaml 
deployment.apps/backend created
service/backend created
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl apply -f cache.yaml 
deployment.apps/cache created
service/cache created
```
Проверяю
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get deployment -n app
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
backend    1/1     1            1           60s
cache      1/1     1            1           18s
frontend   1/1     1            1           3m31s

ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get service -n app
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
backend    ClusterIP   10.233.59.215   <none>        80/TCP    9m10s
cache      ClusterIP   10.233.62.182   <none>        80/TCP    8m28s
frontend   ClusterIP   10.233.30.208   <none>        80/TCP    11m


ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get pods -o wide -n app
NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
backend-5dd9956847-vmbkh    1/1     Running   0          21m   10.233.75.4   node2   <none>           <none>
cache-9d4b97449-d4p52       1/1     Running   0          20m   10.233.75.5   node2   <none>           <none>
frontend-7f55d7684c-mpc6f   1/1     Running   0          24m   10.233.75.3   node2   <none>           <none>
```

4. Создать политики чтобы обеспечить доступ frontend -> backend -> cache. Другие виды подключений должны быть запрещены.  
Создал [network_policy](https://github.com/AlekseyDrobnyi/netology_devops/blob/main/14.3/yml/network_policy.yaml)  
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl apply -f network_policy.yaml 
networkpolicy.networking.k8s.io/all-deny created
networkpolicy.networking.k8s.io/frontend-to-backend created
networkpolicy.networking.k8s.io/backend-to-cache created

ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get networkpolicy
NAME                  POD-SELECTOR   AGE
all-deny              <none>         3m8s
backend-to-cache      app=cache      3m45s
frontend-to-backend   app=backend    3m45s
```

5. Продемонстрировать, что трафик разрешен и запрещен.  
Проверяю доступность frontend -> backend -> cache и запрета сождения в другие Pod-ы  
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl config set-context --current --namespace=app
Context "kubernetes-admin@cluster.local" modified.
```
```bash
ubuntu@ubuntu-VirtualBox:~/.kube$ kubectl get pods -o wide
NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
backend-5dd9956847-vmbkh    1/1     Running   0          21m   10.233.75.4   node2   <none>           <none>
cache-9d4b97449-d4p52       1/1     Running   0          20m   10.233.75.5   node2   <none>           <none>
frontend-7f55d7684c-mpc6f   1/1     Running   0          24m   10.233.75.3   node2   <none>           <none>
```

![image](https://github.com/AlekseyDrobnyi/netology_devops/assets/99823951/fdadf0b2-b089-48ab-b8c7-afe56737852d)


### Правила приема работы

1. Домашняя работа оформляется в своем Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md
